<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="language" content="english">
  <title>Project 2 - CS 61C</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="shortcut icon" type="image/png" href="https://inst.eecs.berkeley.edu/~cs61c/su21/img/favicon.png">
  <link rel="stylesheet" href="Project%202%20-%20CS%2061C_files/bootstrap.css" integrity="sha512-Ez0cGzNzHR1tYAv56860NLspgUGuQw16GiOOp/I2LuTmpSK9xDXlgJz3XN4cnpXWDmkNBKXR/VDMTCnAaEooxA==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="Project%202%20-%20CS%2061C_files/main.css">

  



  <script defer="defer" src="Project%202%20-%20CS%2061C_files/tocbot.js" integrity="sha512-8u1QblAcGUuhEv26YgTYO3+OtPL7l37qiYoPQtahVTaiLn/H3Z/K16TOXJ3U7PDYBiJWCWKM0a+ELUDGDgED2Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



  <script defer="defer" src="Project%202%20-%20CS%2061C_files/bootstrap.js" integrity="sha512-EKWWs1ZcA2ZY9lbLISPz8aGR2+L7JVYqBAYTq5AXgBkSjRSuQEGqWx8R1zAX16KdXPaCjOCaKE8MCpU0wcHlHA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script defer="defer" src="Project%202%20-%20CS%2061C_files/instantpage.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>
  <script defer="defer" type="text/javascript" src="Project%202%20-%20CS%2061C_files/main.js"></script>
</head>

<body>
  <main>
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="https://inst.eecs.berkeley.edu/~cs61c/su21/">
          <img class="d-inline-block me-2 rounded" src="Project%202%20-%20CS%2061C_files/icon-small.png" alt="logo" height="48">
          <span class="align-middle">CS 61C</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle Navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/calendar/">Calendar</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/staff/">Staff</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/policies/">Policies</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://edstem.org/us/courses/6509/discussion/">Ed</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://oh.cs61c.org/">OH Queue</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://venus.cs61c.org/">Venus</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/su21/resources/">Resources</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://inst.eecs.berkeley.edu/~cs61c/archives.html">Semesters</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="section">
      <div class="container">
        

        
<div class="row spec">
  
    <div id="toc-wrapper" class="col-md-3 d-none d-md-block d-print-none sticky-top nav-wrapper"><ul class="toc-list nav flex-column"><li class="nav-item active"><a href="#background" class="nav-link node-name--H2  active">Background</a><ul class="toc-list nav flex-column is-collapsible"><li class="nav-item"><a href="#objectives" class="nav-link node-name--H3 ">Objectives</a></li><li class="nav-item"><a href="#getting-started" class="nav-link node-name--H3 ">Getting Started</a></li><li class="nav-item"><a href="#java-and-python-3-setup" class="nav-link node-name--H3 ">Java and Python 3 Setup</a></li><li class="nav-item"><a href="#general-advice-and-grading" class="nav-link node-name--H3 ">General Advice and Grading</a></li></ul></li><li class="nav-item"><a href="#part-a-mathematical-functions" class="nav-link node-name--H2 ">Part A: Mathematical Functions</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#task-1-getting-started-with-the-abs-function" class="nav-link node-name--H3 ">Task 1: Getting Started with the Abs Function</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#running-tests" class="nav-link node-name--H4 ">Running Tests</a></li><li class="nav-item"><a href="#debugging-tests-with-venus-web-interface" class="nav-link node-name--H4 ">Debugging Tests with Venus Web Interface</a></li><li class="nav-item"><a href="#debugging-test-one-on-venus-web-interface" class="nav-link node-name--H4 ">Debugging test_one on Venus Web Interface</a></li><li class="nav-item"><a href="#editing-the-abs-function-to-pass-test-one" class="nav-link node-name--H4 ">Editing the Abs Function to pass test_one</a></li><li class="nav-item"><a href="#adding-more-tests-for-abs-function" class="nav-link node-name--H4 ">Adding More Tests for Abs Function</a></li><li class="nav-item"><a href="#editing-abs-function-to-pass-test-minus-one" class="nav-link node-name--H4 ">Editing Abs Function to pass test_minus_one</a></li></ul></li><li class="nav-item"><a href="#background-knowledge" class="nav-link node-name--H3 ">Background Knowledge</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#matrix-format" class="nav-link node-name--H4 ">Matrix Format</a></li><li class="nav-item"><a href="#array-strides" class="nav-link node-name--H4 ">Array Strides</a></li></ul></li><li class="nav-item"><a href="#task-1-relu" class="nav-link node-name--H3 ">Task 1: ReLU</a></li><li class="nav-item"><a href="#task-2-argmax" class="nav-link node-name--H3 ">Task 2: ArgMax</a></li><li class="nav-item"><a href="#task-3-1-dot-product" class="nav-link node-name--H3 ">Task 3.1: Dot Product</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#testing-dot-product" class="nav-link node-name--H4 ">Testing: Dot Product</a></li></ul></li><li class="nav-item"><a href="#task-3-2-matrix-multiplication" class="nav-link node-name--H3 ">Task 3.2: Matrix Multiplication</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#testing-matrix-multiplication" class="nav-link node-name--H4 ">Testing: Matrix Multiplication</a></li></ul></li><li class="nav-item"><a href="#submitting-your-code" class="nav-link node-name--H3 ">Submitting Your Code</a></li></ul></li><li class="nav-item"><a href="#part-b-file-operations-and-main" class="nav-link node-name--H2 ">Part B: File Operations and Main</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#background-knowledge-1" class="nav-link node-name--H3 ">Background Knowledge</a></li><li class="nav-item"><a href="#neural-networks" class="nav-link node-name--H3 ">Neural Networks</a></li><li class="nav-item"><a href="#handwritten-digit-classification" class="nav-link node-name--H3 ">Handwritten Digit Classification</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#matrix-file-format" class="nav-link node-name--H4 ">Matrix File Format</a></li><li class="nav-item"><a href="#ecalls-and-utils-s" class="nav-link node-name--H4 ">Ecalls and Utils.s</a></li><li class="nav-item"><a href="#file-operations" class="nav-link node-name--H4 ">File Operations</a></li></ul></li><li class="nav-item"><a href="#task-1-read-matrix" class="nav-link node-name--H3 ">Task 1: Read Matrix</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#testing-read-matrix" class="nav-link node-name--H4 ">Testing: Read Matrix</a></li></ul></li><li class="nav-item"><a href="#task-2-write-matrix" class="nav-link node-name--H3 ">Task 2: Write Matrix</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#testing-write-matrix" class="nav-link node-name--H4 ">Testing: Write Matrix</a></li></ul></li><li class="nav-item"><a href="#task-3-putting-it-all-together" class="nav-link node-name--H3 ">Task 3: Putting it all Together</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#command-line-arguments-and-file-paths" class="nav-link node-name--H4 ">Command Line Arguments and File Paths</a></li><li class="nav-item"><a href="#the-network" class="nav-link node-name--H4 ">The Network</a></li><li class="nav-item"><a href="#testing-classify" class="nav-link node-name--H4 ">Testing classify</a></li><li class="nav-item"><a href="#test-inputs-and-outputs" class="nav-link node-name--H4 ">Test Inputs and Outputs</a></li></ul></li><li class="nav-item"><a href="#submitting-your-code-1" class="nav-link node-name--H3 ">Submitting Your Code</a></li></ul></li><li class="nav-item"><a href="#grading" class="nav-link node-name--H2 ">Grading</a></li><li class="nav-item"><a href="#frequently-asked-questions" class="nav-link node-name--H2 ">Frequently Asked Questions</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#general" class="nav-link node-name--H3 ">General</a></li><li class="nav-item"><a href="#unit-testing-framework" class="nav-link node-name--H3 ">Unit Testing Framework</a></li><li class="nav-item"><a href="#part-a" class="nav-link node-name--H3 ">Part A</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#abs" class="nav-link node-name--H4 ">Abs</a></li><li class="nav-item"><a href="#relu-and-argmax" class="nav-link node-name--H4 ">ReLU and ArgMax</a></li><li class="nav-item"><a href="#dot-product" class="nav-link node-name--H4 ">Dot Product</a></li><li class="nav-item"><a href="#matmul" class="nav-link node-name--H4 ">Matmul</a></li></ul></li><li class="nav-item"><a href="#part-b" class="nav-link node-name--H3 ">Part B</a><ul class="toc-list nav flex-column is-collapsible is-collapsed"><li class="nav-item"><a href="#read-matrix" class="nav-link node-name--H4 ">Read Matrix</a></li><li class="nav-item"><a href="#write-matrix" class="nav-link node-name--H4 ">Write Matrix</a></li><li class="nav-item"><a href="#classify" class="nav-link node-name--H4 ">Classify</a></li></ul></li></ul></li></ul></div>
  
  <div id="toc-content-wrapper" class="content col-md-9">
    <h1 class="title">Project 2: CS61Classify</h1>
    
      <p class="subtitle">Part A Deadline: Thursday, July 8, 11:59:59 PM PT</p>
      <p class="subtitle">Part B Deadline: Wednesday, July 14, 11:59:59 PM PT</p>
    
    
    <h2 id="background">Background</h2>
<p>At the end of this project you will have written all RISC-V assembly code
necessary to run a simple Artificial Neural Network (ANN) on the Venus
RISC-V simulator.
In part A you will implement the basic operations such as a vector dot product,
matrix-matrix multiplication, the argmax and an activation function.
In part B you will combine these basic functions in order to load a pretrained
network and execute it to classify handwritten digits from the MNIST benchmark set.</p>
<h3 id="objectives">Objectives</h3>
<ul>
<li>TSWBAT ("<strong>T</strong>he <strong>S</strong>tudent <strong>W</strong>ill <strong>B</strong>e <strong>A</strong>ble <strong>T</strong>o") implement
numerical computation functions in RISC-V assembly that follow
calling the convention.</li>
<li>TSWBAT call functions in RISC-V assembly.</li>
<li>TSWBAT write RISC-V assembly programs that utilize the heap and interact with
files.</li>
<li>TSWBAT write a test suite that covers corner cases and automatically checks
for the correct operation of the RISC-V functions implemented.</li>
</ul>
<h3 id="getting-started">Getting Started</h3>
<div class="alert alert-warning">
    <b>Warning</b>: this assignment allows groups of 2 students! If you 
have a group, one member should create the repo and invite the other 
group member to that repo. <b>The other group member should NOT create their own repo.</b> If you haven't decided on a group yet, don't create the repo yet. You will not be able to change groups after creating a repo!
</div>
<p>&nbsp;</p>
<p>Visit <a href="https://galloc.cs61c.org/assignments/proj2">Galloc</a>.
 Log in and start the Project 2 assignment. A GitHub repo will be 
created for your team; this will be your repo for any Project 2 work you
 do.</p>
<p>Then, clone your repository locally and add the starter remote</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> git clone https://github.com/61c-student/su21-proj2-GITNAME.git
</span><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> cd su21-proj2-GITNAME 
</span><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> git remote add starter https://github.com/61c-teach/su21-proj2-starter.git
</span></code></pre>
<p>If you ever want to pull <strong>updated</strong> starter code,
you’d execute the following command:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span style="color:#c0c5ce;"> git pull starter main
</span></code></pre><h3 id="java-and-python-3-setup">Java and Python 3 Setup</h3>
<p>Your computer needs be able to run some Java and Python 3 scripts for this project.
Most of your computers should be set up properly from 61A and 61B.
If not, these <a href="https://cs61a.org/lab/lab00/#install-python-3">CS61A</a> and
<a href="http://www-inst.eecs.berkeley.edu/%7Ecs61b/fa19/materials/lab/lab1b/lab1b.html">CS61B</a>
setup instructions should help.
You are also welcome to work on the hives.</p>
<h3 id="general-advice-and-grading">General Advice and Grading</h3>
<ul>
<li>
<p><strong>Testing</strong>
: The unit tester is a simple framework for making writing tests easier.
 The unit tests display how much of your implementation is covered by 
your tests. Specifically, the unit tests will display how many lines of 
your code in your <code>.s</code> file are hit by the unit tests that 
you have written. 100% coverage of your code indicates that you have 
written unit tests that hit all lines of your code, <strong>BUT</strong> it doesn't indicate that your code actually accounts for all scenarios. </p>
</li>
<li>
<p><strong>Grading</strong>
: You will be graded on the quality of your tests. For part A, your unit
 tests should cover 100% of your custom code. For part B, we require 
100% coverage for <code>read_matrix</code> and <code>write_matrix</code>.
 As mentioned in the Testing section, 100% coverage means your unit 
tests hit all the lines of your custom code for the respective <code>.s</code>
 files they are testing. The autograder will give you the result of 80% 
of the overall tests, while 20% of the tests will remain hidden until 
after scores are released. The autograder is rate limited: each 
submission consumes a token, you will be given 6 tokens; each token will
 regenerate after six hours; get started early to limit the number of 
last-minute resubmissions. If you do not have a token, that submission 
will not be graded--even after the deadline has passed.</p>
</li>
<li>
<p><strong>General Advice</strong>
: Pay close attention to the function definition in the assembly template. Implement all argument checks required and call <code>exit2</code> to abort with the
correct error code listed in the respective file's documentation.Pay close attention to calling convention. <strong>While the unit tests will run the <a href="https://cs61c.org/su21/resources/venus-reference/">calling convention checker</a>
 there are many errors that the automated check might miss. Please do 
not rely on this tool as it's merely meant to provide an initial sanity 
check for calling convention.</strong></p>
</li>
</ul>
<h2 id="part-a-mathematical-functions">Part A: Mathematical Functions</h2>
<p><strong>Due Thursday, July 8th</strong></p>
<p>In this part, you will implement some of the matrix operations used by neural networks
These include a <a href="https://en.wikipedia.org/wiki/Dot_product">dot product</a>,
<a href="https://en.wikipedia.org/wiki/Matrix_multiplication">matrix multiplication</a>,
an element-wise <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">rectifier function (ReLU)</a>,
and an <a href="https://en.wikipedia.org/wiki/Arg_max">argmax function</a> for vectors.
But first we will start with a simple <code>abs</code> function which calculates the
absolute value of a given integer.</p>
<h3 id="task-1-getting-started-with-the-abs-function">Task 1: Getting Started with the Abs Function</h3>
<p>The purpose of this section is to get you acquainted with the recommended
workflow using the unit testing framework and the Venus simulator
to better prepare you to complete this project successfully.
Follow along with the video linked below or continue reading the written spec.</p>
<p><a href="https://youtu.be/Q4E8trPRJHk">Task 0: Getting Started with the Abs Function Video</a></p>
<h4 id="running-tests">Running Tests</h4>
<p>We want to start by running all the given sanity tests to verify that they fail since we haven't
started implementing anything. In order to do that run the following commands:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd</span><span style="color:#c0c5ce;"> unittests
</span><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.py</span><span style="color:#bf616a;"> -v
</span></code></pre>
<p>To see the specific assembly tests that the testing framework has generated <code>cd assembly</code>
and view all the different <code>.s</code> test files directly.</p>
<p>For now let's disable most of the assembly tests and worry just about our tests targeting the <code>Abs</code> function.
To disable all tests and rerun just the <code>Abs</code> function tests, run the following:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">rm -rf</span><span style="color:#c0c5ce;"> assembly
</span><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestAbs</span><span style="color:#bf616a;"> -v
</span></code></pre>
<p><em>Hint</em>: The command to run the unit tests has two options to keep in mind <code>unittests.&lt;testName&gt;</code>
targets a specific suite of tests and <code>-v</code> triggers verbose output.</p>
<p><em>Note</em>: The unit tests are using the standard <a href="https://docs.python.org/3/library/unittest.html">Python unittest library</a>.</p>
<p>Notice that <code>test_one</code> fails while <code>test_zero</code> passes; now let's debug this function using the Venus Web Interface!</p>
<h4 id="debugging-tests-with-venus-web-interface">Debugging Tests with Venus Web Interface</h4>
<p>Using the Venus web interface, we can step through our assembly code and inspect registers to find out
why the <code>test_one</code> for the <code>Abs</code> function is failing.
As the first step we must first upload our files to the Venus Web Interface</p>
<h5 id="mounting-repository-to-venus-web-interface">Mounting Repository to Venus Web Interface</h5>
<p><em>Note</em>: mounting does <strong>not</strong> work on Safari due to strict http vs https content mixing policies; use this on Google Chrome or Firefox.</p>
<p>Run the following command from your <strong>local terminal</strong> from within your <code>su21-proj2-&lt;GITNAME&gt;</code> directory. </p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">java -jar</span><span style="color:#c0c5ce;"> tools/venus.jar .</span><span style="color:#bf616a;"> -dm
</span></code></pre>
<p>When you run it, you should see several Javalin messages, launching the server and listening on <code>http://localhost:6161/</code>. The line you need to pay attention to is above the Javalin logo which resembles: "To connect, enter <code>mount http://localhost:6161 vmfs &lt;KEY&gt;</code>. <code>vmfs</code>
 is indicating what the mounted directory will be called on the Venus 
web interface; if you want to call it something else, just replace that 
with your mount name. The <code>KEY</code> will be unique to you and will needed to authenticate your mount request in Venus Web.</p>
<p>Copy the command specified into the <strong>Venus Web Interface Terminal</strong>;
 on your local terminal you should see a prompt saying "An application 
from 127.0.0.1 (or similar) is requesting to connect. If requested, 
please enter in this key to continue to continue with the connection: <code>KEY</code>". Here, you should copy the key from your terminal, paste it, and hit enter. </p>
<p>Now, if you run <code>ls</code> on your Venus Web, you should see the following directories: <code>.</code> (current directory), <code>..</code> (parent directory), <code>&lt;MOUNT_NAME&gt;</code> (what you called the mounted directory). If you <code>cd</code> into <code>&lt;MOUNT_NAME&gt;</code>, you should see your entire <code>proj2</code> file directory.</p>
<p><em>Note</em>: We recommend using Chrome or Firefox browsers. Other browsers may work but have not been tested.</p>
<p>This will mount the repository and give you access to all your 
project files from within the Venus Web Interface to edit, run, and 
debug! Navigate to the Files tab on Venus to see your repositories 
contents.</p>
<h5 id="alternative-zipping-files-to-upload">(Alternative) Zipping Files to Upload</h5>
<p><em>Use this in case the file mounting does not work on your computer.</em></p>
<p>To see full list of commands supported by Venus you can run the <code>help</code> flag on the <code>venus.jar</code> file,
but we've included some of the ones related to zipping below</p>
<ul>
<li><code>upload</code>: Opens up a window allowing you to pick files from your local machine to upload to Venus</li>
<li><code>unzip &lt;ZIP_FILENAME&gt;</code>: Unzips a <code>.zip</code> file into the current working directory.</li>
<li><code>zip &lt;ZIP_FILENAME&gt; &lt;FILENAME_1&gt; &lt;FILENAME_2&gt; ... </code>:
Opens up a window allowing you to download a zip file called <code>ZIP_FILE_NAME</code>,
which contains all the specified files and/or folders. Folders are added to the zip file recursively.</li>
</ul>
<p>When uploading files to the Venus web interface, you'll want to zip ONLY your <code>src</code>, <code>inputs</code>,
and <code>unittests/assembly</code> directories locally, use the <code>upload</code> in the Venus terminal to upload that zip file,
and then <code>unzip</code> to retrieve all your project files.</p>
<p>Alternatively, you can upload individual files to work with.
However, you'll need to make sure the directory structure is the same as the starter repo,
or be prepared to edit the relative paths given to you in the starter code for inputs and <code>.import</code> statements.</p>
<p><strong>Note</strong>: We <strong>HIGHLY</strong> recommend that you regularly copy the changes you've made in the Venus web interface
to your local machine to save them. If you accidentally close the browser window or run <code>edit</code> before running <code>save</code>,
you could lose a large amount of progress if you do not enable 'Save on Close'.
This is one of the primary reasons we recommend running with the .jar file for most of your development,
and only turning to Venus to debug one specific file at a time.**</p>
<p><strong>Note2</strong>: If you do use 'Save on Close' (which you all should),
be aware that there is a limit to the size of its state which it can store (limited by your browsers localStorage).
This is why we say you should only upload the specified directories.**</p>
<h4 id="debugging-test-one-on-venus-web-interface">Debugging <code>test_one</code> on Venus Web Interface</h4>
<p>Navigate to the <strong>Files</strong> tab on Venus to see your files, and navigate to the <code>abs.s</code> file in <code>src/abs.s</code>
and click <strong>edit</strong>. If you do not see the <code>src</code> directory, scroll down.</p>
<p>Then using an <code>ebreak</code> statement set a breakpoint right <strong>above</strong> the command <code>mv a0, zero</code></p>
<p><em>Note</em>: This is one out of two ways to set breakpoints in Venus.
The other way is to click on any instruction (besides <code>ebreak</code>) in the simulator view.
If you click on an <code>ebreak</code> instruction, it will <strong>disable</strong> the breakpoint instead.
One scenario where this comes in handy is when you added an <code>ebreak</code> inside a loop
and - after observing the first few iterations - want to disable it to let the loop finish
executing.</p>
<p>Now before running <code>test_one</code>, go back to the <strong>Files</strong> tab and hit <strong>Save</strong> on the <code>abs.s</code> file.
After saving, navigate to <code>unittests/assembly/TestAbs_test_one_test.s</code> and click <strong>VDB</strong>.
This will launch you into the <strong>Simulator</strong> tab!</p>
<p><em>Note</em>: When the editor tab is active, you can also use <code>Ctrl + S</code> to save the open file.</p>
<p>Now using your basic Venus knowledge from lab3 you can run and step through the test to see <code>a0</code>
being overridden from a <code>1</code> to a <code>0</code>.</p>
<h4 id="editing-the-abs-function-to-pass-test-one">Editing the Abs Function to pass <code>test_one</code></h4>
<p>Let's <strong>remove</strong> the statement <code>mv a0, zero</code> from <code>abs.s</code> and <strong>rerun</strong> <code>test_one</code>.</p>
<p>Observe that <code>test_one</code> indeed does pass after removing the one line of code;
however, the absolute value function is still incorrect!
This toy example is to show that <strong>your code is only as good as how thorough your test cases are</strong>.</p>
<h4 id="adding-more-tests-for-abs-function">Adding More Tests for Abs Function</h4>
<p>Let’s add another test to check if the function works with negative values.
To do this <strong>open</strong> the file <code>unittests/unittest.py</code></p>
<p><strong>Add</strong> this test underneath <code>class TestAbs(TestCase)</code></p>
<pre style="background-color:#2b303b;"><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">test_minus_one</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">):
    </span><span style="color:#65737e;"># Indicates we are creating the test for the `abs.s` file
    </span><span style="color:#c0c5ce;">t = </span><span style="color:#bf616a;">AssemblyTest</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, "</span><span style="color:#a3be8c;">abs.s</span><span style="color:#c0c5ce;">")
    </span><span style="color:#65737e;"># Setting the argument register a0 to have value of -1
    </span><span style="color:#c0c5ce;">t.</span><span style="color:#bf616a;">input_scalar</span><span style="color:#c0c5ce;">("</span><span style="color:#a3be8c;">a0</span><span style="color:#c0c5ce;">", -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)
    </span><span style="color:#65737e;"># Calling the abs function
    </span><span style="color:#c0c5ce;">t.</span><span style="color:#bf616a;">call</span><span style="color:#c0c5ce;">("</span><span style="color:#a3be8c;">abs</span><span style="color:#c0c5ce;">")
    </span><span style="color:#65737e;"># The a0 register is now the return value
    # Checking if a0 is now 1
    </span><span style="color:#c0c5ce;">t.</span><span style="color:#bf616a;">check_scalar</span><span style="color:#c0c5ce;">("</span><span style="color:#a3be8c;">a0</span><span style="color:#c0c5ce;">", </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)
    t.</span><span style="color:#bf616a;">execute</span><span style="color:#c0c5ce;">()
</span></code></pre>
<p><em>Note</em>: By modifying just <code>t.input_scalar</code> and <code>t.check_scalar</code> we can build a brand new test!</p>
<p>Now <strong>rerun</strong> just the <code>Abs</code> Function tests to verify that this test now fails while <code>test_zero</code> and <code>test_one</code> pass.
This is an important step in test driven development to make sure that the tests we wrote fail before implementing
the function:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestAbs</span><span style="color:#bf616a;"> -v
</span></code></pre><h4 id="editing-abs-function-to-pass-test-minus-one">Editing Abs Function to pass <code>test_minus_one</code></h4>
<p><strong>Insert</strong> the following code into <code>abs.s</code></p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">    # branch if positive
    bge a0, zero, done
    # invert a if negative
    sub a0, zero, a0
    done:
</span></code></pre>
<p>Now all <code>Abs</code> Function tests should pass!
Let this be a warning to write good tests and produce well commented code. Happy coding!</p>
<h3 id="background-knowledge">Background Knowledge</h3>
<h4 id="matrix-format">Matrix Format</h4>
<p>In this project, all two-dimensional matrices will be stored as
one-dimensional arrays in
<a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">row-major order</a>.
Row-major order stores all values in a row of a matrix consecutively
and concatenates all row vectors into a single 1-D array starting from the
top-most row.
The alternative column-major order stores all values in a column of a matrix 
consecutively and concatenates all columns vectors into a single 1-D array
starting from the left-most column.
Our choice of row-major order follows the convention of most C/C++ programs.</p>
<p><img src="Project%202%20-%20CS%2061C_files/row_major.jpg" alt=""></p>
<h4 id="array-strides">Array Strides</h4>
<p>The <a href="https://en.wikipedia.org/wiki/Stride_of_an_array">stride of an array</a>
is the number of bytes between the beginning of
consecutive array elements.
So far all arrays we have worked with had unit stride, meaning that there
is not gap between consecutive elements and the stride is <code>sizeof(element)</code>.</p>
<p>In this project, all strides will be given in <em>multiples of the element size</em>
instead of bytes.
Thus the unit stride is just <code>1</code>.</p>
<p>We are going to use the stride to define column vectors in our matrix
(stored in row-major order) without having to copy any elements.
Since row elements are stored consecutively, a row vector is just an
array with unit stride.
However, if we want to get the column vector, we need to skip over the end of
the current row and the beginning of the next row to get to the next element
in the column. Thus the stride will be the number of elements in a row.</p>
<p>Here is a practical example: We have the vector <code>int *a</code> with 3 elements.</p>
<ul>
<li>If the stride is 1, then our vector elements are <code>*(a)</code>, <code>*(a + 1)</code>,
and <code>*(a + 2)</code>, in other words <code>a[0]</code>, <code>a[1]</code>, and <code>a[2]</code>.</li>
<li>However, if our stride is 4, then our elements are at <code>*(a)</code>, <code>*(a + 4)</code>,
and <code>*(a + 8)</code> or in other words <code>a[0]</code>, <code>a[4]</code>, and <code>a[8]</code>.</li>
</ul>
<p>To summarize: In C code, to access the <code>i</code>th element of a vector
<code>int *a</code> with stride <code>s</code>, we use <code>*(a + i * s)</code>, or <code>a[i * s]</code>.
We leave it up to you to translate this memory access pattern into RISC-V
for the dot product in task 3.</p>
<h3 id="task-1-relu">Task 1: ReLU</h3>
<p><strong>Implement</strong> the <code>relu</code> function in <code>src/relu.s</code> which takes in a 1D vector and
applies the <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">rectifier function</a>
on each element, modifying it in place.
This is equivalent to setting every negative value in the vector to 0. If the length of the
vector is less than 1, you should exit the program with error code 32.
Be careful to follow the specification in the header comment in the <code>relu.s</code> file.</p>
<p><em>Note</em>: Our <code>relu</code> function operates on a 1-D vector, not a 2-D matrix.
Since <code>relu</code> works on an element by element basis, independent of the
position of that element in the matrix, we are able to treat our 2-D matrix
which is stored in row-major format as a 1-D vector.</p>
<p><em>Hint</em>: You can run the unit test that we provide you for this task by
running the following command in the <code>unittest</code> directory:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestRelu</span><span style="color:#bf616a;"> -v
</span></code></pre>
<p><em>Hint</em>: to achieve 100% test coverage you will need to add your own tests to
cover all the corner cases in the spec. Think carefully about every branch
in your implementation.</p>
<h3 id="task-2-argmax">Task 2: ArgMax</h3>
<p>The <a href="https://inst.eecs.berkeley.edu/~cs61c/su21/projects/proj2/(https://en.wikipedia.org/wiki/Arg_max)">argmax</a>
function returns the index of the largest element in a vector.
It will be used at the end of our neural network to select the most likely
classification.</p>
<p><strong>Implement</strong> the <code>argmax</code> function in <code>src/argmax.s</code> which takes in a 1D vector
and returns the index of the largest element. If the length of the
vector is less than 1, you should exit the program with error code 32.
Be careful to follow the specification in the header comment in the <code>argmax.s</code> file.</p>
<p><em>Hint</em>: You can run the unit test that we provide you for this task by
running the following command in the <code>unittest</code> directory. Fill in the <code>TODOs</code> in <code>unittests.py</code> to make it work:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestArgmax</span><span style="color:#bf616a;"> -v
</span></code></pre><h3 id="task-3-1-dot-product">Task 3.1: Dot Product</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Dot_product">dot product</a>
of two vectors is defined as</p>
<p><img src="Project%202%20-%20CS%2061C_files/dotproduct.png" alt=""></p>
<p><strong>Implement</strong> the <code>dot</code> function in <code>src/dot.s</code> which takes in two vectors
and returns their dot product. If the length of the vector is less than 1,
this function terminates the program with error code 32. If the stride of either vector is less than 1, 
this function terminates the program with error code 33.
Be careful to follow the specification in the header comment in the <code>dot.s</code> file.</p>
<p><em>Note</em>: This function takes in the stride for each vector as an argument.
Make sure you're considering this when calculating your memory addresses.
Consider re-reading the section on <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj2/#array-strides">array strides</a> in the
background materials.</p>
<p><em>Note</em>: We do not expect you to handle overflow when multiplying.
This means you will not need to use the <code>mulh</code> instruction.</p>
<p><em>Note</em>: keep in mind that - like in C - there is no way for the function to
verify that the vector length argument actually matches the size of memory allocated
for the vector.</p>
<h4 id="testing-dot-product">Testing: Dot Product</h4>
<p>You can run the unit test that we provide you for this task by
running the following command in the <code>unittest</code> directory.
Fill in the <code>TODOs</code> in <code>unittests.py</code> to make it work:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestDot</span><span style="color:#bf616a;"> -v
</span></code></pre>
<p>A basic test provides the <code>dot</code> function with two vectors
<code>v0</code> and <code>v1</code> of size <code>9</code> and unit stride. We thus expect the following
result:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">v0 = [1, 2, 3, 4, 5, 6, 7, 8, 9]
v1 = [1, 2, 3, 4, 5, 6, 7, 8, 9]
dot(v0, v1) = 1 * 1 + 2 * 2 + ... + 9 * 9 = 285
</span></code></pre>
<p>Implement this test using the methods provided by the <code>AssemblyTest</code> class.</p>
<p>Now fill in the <code>test_stride</code> function.
What should happen if you change the length of the vectors to 3 and
the stride of the second vector <code>v1</code> to 2,
without changing the values in static memory?
Now, the vectors contain the following:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">v0 = [1, 2, 3]
v1 = [1, 3, 5]
dot(v0, v1) = 1 * 1 + 2 * 3 + 3 * 5 = 22
</span></code></pre>
<p><em>Note</em>:  <code>v1</code> now has stride 2, so we skip over elements in memory
when calculating the dot product.
However, the pointer <code>v1</code> still points to the same place as before:
the start of the sequence of integers 1 to 9 in memory.</p>
<p><em>Hint</em>: as before, you will need to add multiple test to achieve 100% coverage.</p>
<h3 id="task-3-2-matrix-multiplication">Task 3.2: Matrix Multiplication</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Matrix_multiplication">matrix multiplication</a>
of two matrices A and B results in the output matrix C = AB,
where C[i][j] is equal to the dot product of the i-th row of A
and the j-ith column of B.</p>
<p><em>Note</em>: If the dimensions of A are (n * m),
and the dimensions of B are (m * k),
then the dimensions of C must be (n * k).</p>
<p><em>Note</em>: Unlike integer multiplication, matrix multiplication is not commutative, AB != BA.</p>
<p><strong>Implement</strong> the <code>matmul</code> function in <code>src/matmul.s</code> which takes in
two matrices, <code>m0</code> and <code>m1</code> in row-major format and multiplies them,
storing the resulting matrix <code>C</code> in pre-allocated memory.
You must use the <code>dot</code> function from the previous task to 
calculate
each entry of the result matrix. If the dimensions of either m0 or m1 do
 not make sense (any dimension is 0 or less), or if the dimensions are 
mismatched (that is, the matrix multiplication is undefined), 
this function terminates the program with exit code 34.
Be careful to follow the specification in the header comment in the <code>matmul.s</code> file.</p>
<p><em>Note</em>: <code>m0</code> is the left matrix, and <code>m1</code> is the right matrix.</p>
<p><em>Hint</em>: The stride for row vectors will be different than the stride for
column vectors when calling the <code>dot</code> function.
Consider re-reading the section on <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj2/#array-strides">array strides</a> in the
background materials.</p>
<h4 id="testing-matrix-multiplication">Testing: Matrix Multiplication</h4>
<p>We only provide a skeleton test for matrix multiplication. By now you should
be familiar with how to use the testing framework.</p>
<p>You can run the unit test by running the following command in the <code>unittest</code> directory:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestMatmul</span><span style="color:#bf616a;"> -v
</span></code></pre>
<p><em>Hint</em>: as before, you will need to add multiple tests to achieve 100% coverage.</p>
<h3 id="submitting-your-code">Submitting Your Code</h3>
<p>Please submit using Gradescope to Project 2A,
using the GitHub submission option to ensure that your files are in the right place.</p>
<div class="alert alert-warning">
    <b>Warning</b>: If you have a partner, you <b>MUST</b> add your 
partner to every submission on Gradescope or it may be flagged for 
cheating. The person submitting can change, but both partners must be 
added to every submission.
</div>
<p><em>Note</em>: you should not add any <code>.import</code> statements to the starter code.
For example, when the autograder is importing <code>matmul.s</code>, it will also import
<code>dot.s</code> and <code>utils.s</code>, so your <code>matmul.s</code> file itself should never
contain any <code>.import</code> statements.</p>
<p><em>Note</em>: also make sure to not have any <code>ecall</code> instructions in your code.
Use the functions we provide in <code>utils.s</code>.</p>
<p><em>Note</em>: Like last project, 80% of the autograder tests will be visible to you upon submission, while 20%
of the tests will remain hidden until scores are released.</p>
<p><strong>Below is a list of all the error codes for you convenience:</strong></p>
<p><em><strong>Relu</strong></em></p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">1. Error Code **32**: If the length of the vector is less than 1
</span></code></pre>
<p><em><strong>Argmax</strong></em></p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">1. Error Code **32**: If the length of the vector is less than 1
</span></code></pre>
<p><em><strong>Dot</strong></em></p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">1. Error Code **32**: If length of either vector is less than 1
2. Error Code **33**: If the stride of either vector is less than 1
</span></code></pre>
<p><em><strong>Matmul</strong></em></p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">1. Error Code **34**: If dimensions of m0 do no make sense
2. Error Code **34**: If dimensions of m1 do no make sense
3. Error Code **34**: If dimensions of m0/m1 are not valid for matrix multiplication
</span></code></pre><p>&nbsp;</p>
<p><strong>Below is a list of all the tests for your convenience:</strong></p>
<ol>
<li>Unit Test Coverage (<strong>5</strong> pts)</li>
<li>Sanity Tests (<strong>4</strong> pts)</li>
<li>Relu (<strong>14</strong> pts)</li>
<li>Argmax (<strong>14</strong> pts)</li>
<li>Dot Product (<strong>13</strong> pts)</li>
<li>Matrix Multiplication (<strong>14</strong> pts)</li>
<li>Mismatched Matrix Multiplication (<strong>4</strong> pts)</li>
<li>Negative Dimensions (<strong>12</strong> pts)</li>
<li>Matrix Multiplication with unknown dot.s     <strong>[HIDDEN]</strong></li>
<li>Length 1 vectors     <strong>[HIDDEN]</strong></li>
</ol>
<h2 id="part-b-file-operations-and-main">Part B: File Operations and Main</h2>
<p><strong>Due Wednesday, July 14th</strong></p>
<p>In this part, you will implement functions to read matrices from and
write matrices to binary files.
Then you will combine all individual functions to run a pre-trained MNIST
digit classifier.</p>
<h3 id="background-knowledge-1">Background Knowledge</h3>
<h3 id="neural-networks">Neural Networks</h3>
<p>At a basic level, a neural networks tries to approximate a 
(non-linear) function that maps your input into a desired output. A 
basic neuron consists of a weighted linear combination of the input, 
followed by a non-linearity -- for example, a threshold. Consider the 
following neuron, which implements the logical <code>AND</code> operation:</p>
<p><img src="Project%202%20-%20CS%2061C_files/neuron.png" alt=""></p>
<p>It is easy to see that for A=0, B=0, the linear combination 0*0.6 + 
0*0.6 = 0, which is less than the threshold of 1 and will result in a 0 
output. With an input A=0, B=1 or A=1, B=0 the linear combination will 
results in 1<em>0.6 + 0</em>0.6 = 0.6, which is less than 1 and result 
in a 0 output. Similarly, A=1, B=1 will result in 1*0.6+1*0.6=1.2, which
 is greater than the threshold and will result in a 1 output! What is 
interesting is that the simple neuron operation can also be described as
 an inner product between the vector [A,B]^T and the weights vector 
[0.6,0.6]^T followed by as thresholding, non-linear operation.</p>
<p>More complex functions can not be described by a simple neuron alone.
 We can extend the system into a network of neurons, in order to 
approximate the complex functions. For example, the following 2 layer 
network approximates the logical function <code>XOR</code>:</p>
<p><img src="Project%202%20-%20CS%2061C_files/XOR.png" alt=""></p>
<p>The above is a 2 layer network. The network takes 2 inputs, computes 2
 intemediate values, and finally computes a single final output.</p>
<p>It can be written as matrix multiplications with matrices <code>m_0</code> and <code>m_1</code> with thresholding operations in between as shown below:</p>
<p><img src="Project%202%20-%20CS%2061C_files/mtx.png" alt=""></p>
<p>Convince yourself that this implements an <code>XOR</code> for the appropriate inputs!</p>
<p>You are probably wondering how the weights of the network were 
determined? This is beyond the scope of this project, and we would 
encourage you to take advanced classes in numerical linear algebra, 
signal processing, machine learning and optimization. We will only say 
that the weights can be trained by giving the network pairs of correct 
inputs and outputs and changing the weights such that the error between 
the outputs of the network and the correct outputs is minimized. 
Learning the weights is called: "Training". Using the weights on inputs 
is called "Inference". We will only perform inference, and you will be 
given weights that were pre-trained by your dedicated TA's.</p>
<h3 id="handwritten-digit-classification">Handwritten Digit Classification</h3>
<p>In this project we will implement a similar, but slightly more complex network
which is able to classify handwritten digits.
As inputs, we will use the <a href="http://yann.lecun.com/exdb/mnist/">MNIST</a> data set,
which is a dataset of 60,000 28x28 images containing handwritten digits
ranging from 0-9.
We will treat these images as "flattened" input vectors of size 784 (<code>= 28 * 28</code>).
In a similar way to the example before, we will perform matrix multiplications
with pre-trained weight matrices <code>m_0</code> and <code>m_1</code>.
Instead of thresholding we will use two different non-linearities:
The <code>ReLU</code> and <code>ArgMax</code> functions. Details will be provided in
descriptions of the individual tasks.</p>
<p><img src="Project%202%20-%20CS%2061C_files/MNIST.png" alt=""></p>
<h4 id="matrix-file-format">Matrix File Format</h4>
<p>We will use a custom binary format to store the size and integer values of a matrix.
We also define a plaintext representation and provide a <code>convert.py</code> script
in the <code>tools</code> directory which allows you to translate between the two formats:</p>
<ul>
<li><code>python3 convert.py file.bin file.txt --to-ascii</code> to go from binary to plaintext</li>
<li><code>python3 convert.py file.txt file.bin --to-binary</code> to go from plaintext to binary</li>
</ul>
<p><em>Note</em>: the plaintext format is useful for you to get a human readable representation
of the matrices while the binary format will be used by your RISC-V assembly
code to load and store matrices.</p>
<h5 id="plaintext-format">Plaintext Format</h5>
<p>The first line of the plaintext file will contain two integers,
representing number of rows and columns of the matrix.
Every line afterwards is a row of the matrix.
For example, a plaintext file containing a 3x3 matrix would look like this:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">3 3
1 2 3
4 5 6
7 8 9

</span></code></pre>
<p><em>Note</em>: a newline is required after the last row of the matrix.</p>
<p><em>Note 2</em>: do not assume square matrices as inputs.</p>
<h5 id="binary-format">Binary Format</h5>
<p>The first 8 bytes of the binary file represent two 4 byte integers.
These integers are the number of rows and columns of the matrix.
Every 4 following bytes represents an integer that is an element of the matrix,
in row-major order. There are no gaps between elements.
The number of elements must always correspond to the product of number of rows
and number of columns.
The integers are stores in <em>little-endian</em> format. We elaborate on this
bellow.</p>
<p><em>Note</em>: The size of a MxN matrix stored in this format is <code>sizeof(int) * (2 + m*n)</code>.</p>
<h5 id="viewing-binary-files">Viewing Binary Files</h5>
<p>In order to view arbitrary binary files on the command line we recommend the <code>xxd</code> command.
Its default functionality is to output the raw bits of the file in a hex representation.</p>
<p>For example, let's say the plaintext example in the previous section is stored in
<code>file.txt</code> in the main directory.
We can run <code>python tools/convert.py file.txt file.bin --to-binary</code>
to convert it to a binary format, then <code>xxd file.bin</code>, which should print the following:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">00000000: 0300 0000 0300 0000 0100 0000 0200 0000  ................
00000010: 0300 0000 0400 0000 0500 0000 0600 0000  ................
00000020: 0700 0000 0800 0000 0900 0000            ............
</span></code></pre>
<p>If you interpret this output 4 bytes at a time (equivalent to 8 hex digits)
in little-endian order (see below), you'll see that they correspond to
the values in the plaintext file.
Don't forget that the first and second 4 bytes are integers representing the dimensions
and the rest are integer elements of the matrix.</p>
<p>Please try out the above example by generating the <code>file.txt</code>,
running <code>convert.py</code> and inspecting the result with <code>xxd</code>.</p>
<p><em>Note</em>: while you can also use the <code>hexdump</code> program to inspect bytes,
the ordering/endianness of bytes will be different. In order to keep
things simple, <code>xxd</code> will be the only tool supported by TAs in office
hours and signoffs.</p>
<p><em>Note</em>: the simple <code>xxd</code> command also works on the Venus web interface shell.</p>
<p><em>Note</em>: files, as all files in this spec, passed in as 
arguments to scripts, functions, etc... are assumed to be either 
relative paths to the directory from which you're running the script or 
test or that they're the absolute path from root.</p>
<h5 id="endianness">Endianness</h5>
<p>It is important to note that the bytes are in <em>little-endian</em> order.
This means the least significant byte is placed at the lowest memory address.
For files, the start of the file is considered the "lower address".
This relates to how we read files into memory,
and the fact that the start/first element of an array is usually at the lowest memory address.</p>
<p>RISC-V uses little-endian by default, and our files are all little-endian as well.
In general you should not have to worry about endianness when writing code.
But it is important to keep endianess in mind when debugging and inspecting
bytes in memory or in a file (e.g., using <code>xxd</code>).</p>
<p>This screenshot from Venus shows how the integer <code>0x0A0B0C0D</code> is stored in memory:</p>
<p><img src="Project%202%20-%20CS%2061C_files/little_endian.png" alt=""></p>
<h4 id="ecalls-and-utils-s">Ecalls and Utils.s</h4>
<p>The <code>ecall</code> instruction is a special command in RISC-V,
and corresponds to a environment/system call.
We have created helper functions in <code>src/utils.s</code> that wrap around
the various different ecalls for you to use.
In the project you must <strong>never make ecalls directly</strong> in you own code.
Always use the helper functions.</p>
<p><em><strong>ecalls are expensive and should be minimally used for efficiency!</strong></em></p>
<p>All helper functions are documented in inline comments in <code>utils.s</code>,
alongside their arguments and return values. Take some time to look
through <code>utils.s</code> to familizarize yourself with them. <strong>You will need to use
them in the following tasks.</strong></p>
<h4 id="file-operations">File Operations</h4>
<p>In this section we are going to provide some more details on the helper
functions that are used to access files.
You will need to use them in order to implement the <code>read_matrix</code>
and <code>write_matrix</code> functions.</p>
<h5 id="fopen"><code>fopen</code></h5>
<p>Opens a file that we can then read and/or write to, depending on the permission bit we provide.
Returns a file descriptor, which is a unique integer tied to the file
Must be called on a file before any other operations can be done on it.</p>
<ul>
<li>
<p><strong>Arguments:</strong></p>
<ul>
<li><code>a1</code> is a pointer to a string containing the filename of the file to open</li>
<li><code>a2</code> is an integer denoting the permissions we open the file with.
For example, we can open the file with read permissions, which prevents us from writing to it.
For this project, we only really care about a few basic permission bits: <code>0</code>,
which corresponds to <code>r</code> for read only permission, and <code>1</code> which corresponds to <code>w</code> for write only permission.
<em>Note</em>: <code>w</code> will overwrite the file if it already exists, and create it if it doesn't.</li>
</ul>
</li>
<li>
<p><strong>Return Values</strong></p>
<ul>
<li><code>a0</code> is a file descriptor, which is a unique integer tied to the file.
We will call future file-related functions on this file descriptor,
so we know which opened file we're reading/writing/closing.
On failure, <code>a0</code> is set to <code>-1</code>.</li>
</ul>
</li>
</ul>
<h5 id="fread"><code>fread</code></h5>
<p>Reads a given number of bytes from a file into a buffer, which is a preallocated chunk of memory to store the bytes.
Note that repeated reads will read consecutive bytes from the file.
For example, two <code>fread</code>s of 8 bytes on a file will read the first 8 bytes and then the second 8 bytes.
It will not read the same 8 bytes twice.</p>
<ul>
<li>
<p><strong>Arguments:</strong></p>
<ul>
<li><code>a1</code> is the file descriptor of the file we want to read from, previously returned by <code>fopen</code>.</li>
<li><code>a2</code> is a pointer to the buffer that we're going to read the bytes from the file into.
This must be an appropriate amount of memory that was allocated before calling the function,
and passed in as a pointer.</li>
<li><code>a3</code> is the number of bytes to read from the file.</li>
</ul>
</li>
<li>
<p><strong>Return Values</strong></p>
<ul>
<li><code>a0</code> is the number of bytes actually read from the file.
If the number of bytes actually read differs from the number of bytes specified in the input,
then we either hit the end of the file or there was an error.</li>
</ul>
</li>
</ul>
<h5 id="fwrite"><code>fwrite</code></h5>
<p>Writes a given number of elements of a given size.
Like <code>fread</code>, subsequent writes to the same file do not overlap, but are rather appended to each other.
Note that unlike <code>fread</code>, we don't pass in the total number of bytes but rather the total number
of elements and the size of each element in bytes. We can multiply the two to find the total number of bytes written.</p>
<p>Additionally, note that our writes aren't actually saved until we run <code>fclose</code> or <code>fflush</code>.</p>
<ul>
<li>
<p><strong>Arguments:</strong></p>
<ul>
<li><code>a1</code> is the file descriptor of the file we want to write to, previously returned by <code>fopen</code>.</li>
<li><code>a2</code> is a pointer to a buffer containing what we want to write to the file.</li>
<li><code>a3</code> is the number of elements to write out of the buffer</li>
<li><code>a4</code> is the size of each buffer element in bytes</li>
</ul>
</li>
<li>
<p><strong>Return Values</strong></p>
<ul>
<li><code>a0</code> is the number of elements actually written to the file.
If <code>a0 != a3</code>, then we either hit the end of the file or there was an error.</li>
</ul>
</li>
</ul>
<h5 id="fclose"><code>fclose</code></h5>
<p>Closes the file once we're done with it, saving any writes we've made to it.</p>
<ul>
<li>
<p><strong>Arguments:</strong></p>
<ul>
<li><code>a1</code> is the file descriptor of the file we want to close to, previously returned by <code>fopen</code>.</li>
</ul>
</li>
<li>
<p><strong>Return Values</strong></p>
<ul>
<li><code>a0</code> is 0 on success, and -1 otherwise.</li>
</ul>
</li>
</ul>
<h3 id="task-1-read-matrix">Task 1: Read Matrix</h3>
<p><strong>Implement</strong> the <code>read_matrix</code> function in <code>src/read_matrix.s</code> which uses the file operations we described above
to read a binary matrix file into memory.</p>
<ul>
<li>If malloc returns an error,
this function terminates the program with error code 48</li>
<li>If you receive an fopen error or eof, 
this function terminates the program with error code 64</li>
<li>If you receive an fread error or eof,
this function terminates the program with error code 66</li>
<li>If you receive an fclose error or eof,
this function terminates the program with error code 65</li>
</ul>
<p>Pay special attention to returning the correct exit codes (shown above and in the <code>read_matrix.s</code> file) if any file operation fails or
doesn't return the expected number of bytes.</p>
<p><em>Note</em>: unique exit codes will help you debug your solution by pointing you to where the program exited.</p>
<p><em>Hint</em>: Recall that the first 8 bytes contains the two 4 byte dimensions of the matrix,
which will tell you how many bytes to read from the rest of the file.
Additionally, recall that the binary matrix file is already in row-major order.</p>
<p><em>Hint</em>: You'll need to allocate memory for the matrix in this function as well.
This will require calls to <code>malloc</code> , which is in <code>util.s</code> and also described in the background section above.</p>
<p><em>Note</em>: RISC-V only allows for <code>a0</code> and <code>a1</code> to be return registers,
and our function needs to return three values:
The pointer to the matrix in memory, the number of rows, and the number of columns.
We get around this by having two int pointers passed in as arguments.
We set these integers to the number of rows and columns, and return just the pointer to the matrix.</p>
<h4 id="testing-read-matrix">Testing: Read Matrix</h4>
<p>We only provide a skeleton test. By now you should be familiar with how to use the testing framework.</p>
<p>You can run the unit test by running the following command in the <code>unittest</code> directory:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestReadMatrix</span><span style="color:#bf616a;"> -v
</span></code></pre>
<p><em>Hint</em>: as before, you will need to add multiple tests to achieve 100% coverage.</p>
<p><em>Hint</em>: You can use the <code>fail</code> argument to the <code>execute</code> method in order to make system functions fail.
This works for <code>fopen</code>, <code>fclose</code>, <code>fread</code>, <code>fwrite</code> and <code>malloc</code>.</p>
<p><em>Note</em>: as a reminder, the basic sanity test we provide in <code>inputs/test_read_matrix</code> is insufficient and the assumption of square matrices can lead to issues further down the line.</p>
<h3 id="task-2-write-matrix">Task 2: Write Matrix</h3>
<p><strong>Implement</strong> the <code>write_matrix</code> function in <code>src/write_matrix.s</code> which uses the file operations we described above
to write from memory to a binary matrix file.</p>
<ul>
<li>If you receive an fopen error or eof,
this function terminates the program with error code 64</li>
<li>If you receive an fwrite error or eof,
this function terminates the program with error code 67</li>
<li>If you receive an fclose error or eof,
this function terminates the program with error code 65</li>
</ul>
<p>Pay special attention to returning the correct exit codes (shown above and in the <code>write_matrix.s</code> file) if any file operation fails or
doesn't return the expected number of bytes.</p>
<h4 id="testing-write-matrix">Testing: Write Matrix</h4>
<p>We only provide a skeleton test. By now you should be familiar with how to use the testing framework.</p>
<p>You can run the unit test by running the following command in the <code>unittest</code> directory:</p>
<pre style="background-color:#2b303b;"><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python3 -m</span><span style="color:#c0c5ce;"> unittest unittests.TestWriteMatrix</span><span style="color:#bf616a;"> -v
</span></code></pre>
<p><em>Hint</em>: as before, you will need to add multiple test to achieve 100% coverage.</p>
<p><em>Hint</em>: You can use the <code>fail</code> argument to the <code>execute</code> method in order to make system functions fail.
This works for <code>fopen</code>, <code>fclose</code>, <code>fread</code>, <code>fwrite</code> and <code>malloc</code>.</p>
<h3 id="task-3-putting-it-all-together">Task 3: Putting it all Together</h3>
<p><strong>Implement</strong> the <code>classify</code> function in <code>src/classify.s</code>.</p>
<ul>
<li>If there are an incorrect number of command line args,
this function terminates the program with exit code 35</li>
<li>If malloc fails, this function terminates the program with exit code 48</li>
</ul>
<p>Pay special attention to returning the correct exit codes (shown above and in the <code>classify.s</code>
 file) if any file operation fails or
doesn't return the expected number of bytes and the expected printing 
behavior. You must return the classification as well as print them to 
receive credit.</p>
<p>This will bring together everything you've written so far,
and create a basic sequence of functions that will allow you
to classifiy the preprocessed MNIST inputs using the pretrained matrices we've provided.
You may need to malloc space when reading in matrices and computing the layers of the network,
but remember to always free all data allocated at the end of this process.
More information about the <code>free</code> function is available in <code>utils.s</code> and the background section above.
The classify function will be wrapped by the <code>main.s</code> file meaning you still must follow calling convention!
The <code>main.s</code> file, in what we gave you, is a dummy main which will directly call your <code>classify</code> function
(and pass in the command line arguments) though it could always do more than that! You should view the <code>classify</code> function
as a library function which may be called by a program multiple times to perform classifications on different inputs so
you should be very careful to adhear to its specification.</p>
<h4 id="command-line-arguments-and-file-paths">Command Line Arguments and File Paths</h4>
<p>The filepaths for the <code>input</code>, <code>m0</code>, <code>m1</code>, and the <code>output</code> to write to will all be passed in on the command line.
RISC-V handles command line arguments in the same way as C,
at the start of the main function <code>a0</code> and <code>a1</code> will be set to <code>argc</code> and <code>argv</code> respectively.
In addition, we have added an arg <code>a2</code> which will tell you if you should print out the classification value and a new line if it is zero.
If this is not set to 0, you <strong>MUST NOT</strong> print out anything or you will fail tests!
This arg can be useful if you want to run multiple classifications in the same script.</p>
<p>We will call <code>main.s</code> in the following way from the root directory:
<code>java -jar tools/venus.jar &lt;venus flags&gt; src/main.s &lt;M0_PATH&gt; &lt;M1_PATH&gt; &lt;INPUT_PATH&gt; &lt;OUTPUT_PATH&gt;</code></p>
<p>If you're testing from any other directory, make sure your path to <code>main.s</code> and filepaths correspond to your CWD
(current working directory).</p>
<p>Note that the pointer for to the string <code>M0_PATH</code> will be located at index 1 of <code>argv</code>, <code>M1_PATH</code> at index 2, and so on.
<code>venus flags</code> are not considered in total number of command line arguments.</p>
<p><em>Note</em>: If the number of command line arguments is different from what is expected, exit with the correct exit code.</p>
<p><em>Note</em>: While <code>classify</code> is its own function, we are acting as if it is the main function.
Making it a function other than main is useful as we can now chain classifications and
perform more complex procedures as we can get the result of a classification programmatically and
perform other operations based off of the result!</p>
<h4 id="the-network">The Network</h4>
<p>The first thing you'll need to do (after verifying the number of command line arguments) is load <code>m0</code>, <code>m1</code>,
and the <code>input</code> matrices into memory by making multiple calls to <code>read_matrix</code>, using command line arguments.
Remember you need to pass in two integer pointers as arguments.</p>
<p>Next, you'll want to use those three matrices to calculate the scores for our input.
Our network consists of a matrix multiplication with <code>m0</code>, followed by a relu on the result,
and then a second matrix multiplication with <code>m1</code>.
At the end of this, we will have a matrix of scores for each classification.
We then pick the index with the highest score, and that index is the classification for our input.</p>
<p>Given two weight matrices <code>m0</code> and <code>m1</code>, along with an input matrix <code>input</code>,
the pseudocode to generate the scores for each class is as follows:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">hidden_layer = matmul(m0, input)
relu(hidden_layer) # Recall that relu is performed in-place
scores = matmul(m1, hidden_layer)
</span></code></pre>
<p>Once you've obtained the scores, we expect you to save them to the output file passed in on the command line.
Then, call <code>argmax</code>, which will return a single integer representing the classification for your input,
and print it (if the value of <code>a2</code> indicates that you should print).</p>
<p><em>Hint</em>: when calling <code>argmax</code> and <code>relu</code>, you should treat your inputs as 1D arrays.
That means the length you pass into the function should be the number of elements in your entire matrix.</p>
<h4 id="testing-classify">Testing <code>classify</code></h4>
<p>A simple sanity check can be run like this:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">python3 -m unittest unittests.TestMain -v
</span></code></pre>
<p>You should add more test cases to <code>TestClassify</code> in order to try out some of the corner cases in the spec.</p>
<p><em>Hint</em>: with the testing facilities that we provide to you, you probably will not be able to reach 100% coverage
for your <code>classify</code> code. Do you know why?</p>
<h4 id="test-inputs-and-outputs">Test Inputs and Outputs</h4>
<p>All test inputs are contained in <code>inputs</code>.
Inside, you'll find a folder containing inputs for the mnist network,
as well three other folders containing smaller networks.</p>
<p>Each network folder contains a <code>bin</code> and <code>txt</code> subfolder.
The <code>bin</code> subfolder contains the binary files that you'll run <code>main.s</code> on,
while the <code>txt</code> subfolder contains the plaintext versions for debugging and calculating the expected output.</p>
<p>Within the <code>bin</code> and <code>txt</code> subfolders, you'll find files for <code>m0</code> and <code>m1</code> which define the network,
and a folder containing several inputs. </p>
<p>For MNIST, there are two additional folders:</p>
<ul>
<li><code>txt/labels/</code> contains the true labels for each input, which are the actual digits
that each corresponding input image contains. </li>
<li><code>student_inputs/</code> contains a script to help you run your own input images, as well as an example.</li>
</ul>
<h5 id="simple">Simple</h5>
<p>Apart from MNIST, we've provided several smaller input networks for you to run your <code>main</code> function on.
<code>simple0</code>, <code>simple1</code>, and <code>simple2</code> are all smaller inputs that will be easier to debug.</p>
<p>To test on the first input in <code>simple0</code> for example, run the following:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">java -jar tools/venus.jar src/main.s -ms -1 inputs/simple0/bin/m0.bin inputs/simple0/bin/m1.bin inputs/simple0/bin/inputs/input0.bin  outputs/test_basic_main/student_basic_output.bin
</span></code></pre>
<p>You can then convert the written file to plaintext, check that it's values are correct,
and that the printed integer is indeed the index of the largest element in the output file.</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">python3 tools/convert.py --to-ascii output.bin output.txt
</span></code></pre>
<p>For verifying that the output file itself is correct, you can run the inputs through
a matrix multiplication calculator like <a href="https://m.matrix.reshish.com/multCalculation.php">this one</a>,
which allows you to click "insert" and copy/paste directly from your plaintext matrix file.
Make sure you manually set values to zero for the ReLU step.</p>
<p><em>Note</em>: the provided files cover a variety of dimensions.
For example the <code>simple2</code> inputs have more than one column in them,
meaning that your "scores" matrix will also have more than one column.
Your code should still work as expected in this case, writing the matrix of "scores" to a file,
and printing a single integer that is the row-major index of the largest element of that matrix.</p>
<h5 id="mnist">MNIST</h5>
<p>All the files for testing the mnist network are contained in <code>inputs/mnist</code>.
There are both binary and plaintext versions of <code>m0</code>, <code>m1</code>, and 9 input files.</p>
<p>To test on the first input file for example, run the following:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">java -jar tools/venus.jar src/main.s -ms -1 inputs/mnist/bin/m0.bin inputs/mnist/bin/m1.bin inputs/mnist/bin/inputs/mnist_input0.bin  outputs/test_mnist_main/student_mnist_outputs.bin
</span></code></pre>
<p>(Note that we run with the <code>-ms -1</code> flag, as MNIST inputs are large and we need to increase the max instructions
Venus will run)</p>
<p>This should write a binary matrix file <code>student_mnist_outputs.bin</code> which contains your scores for each digit,
and print out the digit with the highest score.
You can compare the printed digit versus the one in <code>inputs/mnist/txt/labels/label0.txt</code>.</p>
<p>You can check the printed digit printed by <code>main</code> against the plaintext labels for each of the input files
in the <code>mnist/txt/labels</code> folder.</p>
<p>We've also included a script <code>inputs/mnist/txt/print_mnist.py</code>,
which will allow you to view the actual image for every mnist input.
For example, you can run the following command from the directory <code>inputs/mnist/txt</code>
to print the actual image for <code>mnist_input8</code> as ASCII art alongside the true label.
If you run the command from your root directory, include the full path.</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">python3 print_mnist.py 8
</span></code></pre>
<p><em>Hint</em>: not all inputs will classify properly.
A neural network will practically never have 100% accuracy in its predictions.
In our test cases specifically, <code>mnist_input2</code> and <code>mnist_input7</code> will be misclassified to 9 and 8 respectively.
All other test cases should classify correctly.</p>
<h5 id="generating-your-own-mnist-inputs">Generating Your Own MNIST Inputs</h5>
<p>Just for fun, you can also draw your own handwritten digits and pass them to the neural net.
First, open up any basic drawing program like Microsoft Paint.
Next, resize the image to 28x28 pixels, draw your digit, and save it as a <code>.bmp</code> file in
the directory <code>inputs/mnist/student_inputs/</code>.</p>
<p>Inside that directory, we've provided <code>bmp_to_bin.py</code> to turn this <code>.bmp</code> file into
a <code>.bin</code> file for the neural net, as well as an <code>example.bmp</code> file.
To convert it, run the following from inside the <code>inputs/mnist/student_inputs</code> directory:</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">python bmp_to_bin.py example
</span></code></pre>
<p>This will read in the <code>example.bmp</code> file, and create an <code>example.bin</code> file. We can then input it into our neural net,
alongside the provided <code>m0</code> and <code>m1</code> matrices.</p>
<pre style="background-color:#2b303b;"><code><span style="color:#c0c5ce;">java -jar tools/venus.jar src/main.s -ms -1 -it inputs/mnist/bin/m0.bin inputs/mnist/bin/m1.bin inputs/mnist/student_inputs/example.bin  outputs/test_mnist_main/student_input_mnist_output.bin
</span></code></pre>
<p>You can convert and run your own <code>.bmp</code> files in the same way.
You should be able to achieve a reasonable accuracy with your own input images.</p>
<h3 id="submitting-your-code-1">Submitting Your Code</h3>
<p>Please submit using Gradescope to Project 2B,
using the GitHub submission option to ensure that your files are in the right place.</p>
<div class="alert alert-warning">
    <b>Warning</b>: If you have a partner, you <b>MUST</b> add your 
partner to every submission on Gradescope or it may be flagged for 
cheating. The person submitting can change, but both partners must be 
added to every submission.
</div>
<p><em>Note</em>: you should not add any <code>.import</code> statements to the starter code.
For example, when the autograder is importing <code>matmul.s</code>, it will also import
<code>dot.s</code> and <code>utils.s</code>, so your <code>matmul.s</code> file itself should never
contain any <code>.import</code> statements.</p>
<p><em>Note</em>: also make sure to not have any <code>ecall</code> instructions in your code.
Use the functions we provide in <code>utils.s</code>.</p>
<p><strong>Below is a list of all the tests for your convenience:</strong></p>
<ol>
<li>Unit Test Coverage (<strong>5</strong> pts)</li>
<li>Sanity Tests (<strong>4</strong> pts)</li>
<li>Read Matrix (Basic Calling Convention) (<strong>5</strong> pts)</li>
<li>Read Matrix (Full Calling Convention) (<strong>5</strong> pts)</li>
<li>Write Matrix (Basic Calling Convention) (<strong>5</strong> pts)</li>
<li>Write Matrix (Full Calling Convention) (<strong>5</strong> pts)</li>
<li>Classify (Basic Calling Convention) (<strong>7</strong> pts)</li>
<li>Classify (Full Calling Convention) (<strong>7</strong> pts)</li>
<li>Classify with incorrect number of command line arguments (<strong>4</strong> pts)</li>
<li>File Operation Errors   (<strong>28</strong> pts)</li>
<li>Free all allocated blocks  (<strong>5</strong> pts)</li>
<li>Multiple Classify (<strong>6</strong> pts) [HIDDEN]</li>
<li>Test Chain Classify (<strong>14</strong> pts) [HIDDEN]</li>
</ol>
<h2 id="grading">Grading</h2>
<p>For both 2A and 2B, the grading will consist of visible and hidden 
tests. 80% of the tests will be visible to you when you submit your 
project to gradescope, while the other 20% will be hidden until grades 
are released. The tests that are visible have distinct 
names/descriptions to strongly hint at what they are testing, so if you 
are failing any of them, creating a custom test hitting that same test 
case is strongly encouraged. We have also listed all the test names for 
both parts in their respective 'Submitting Your Code' sections. Overall,
 Project 2A and Project 2B will each account for 50% of your total 
Project 2 grade.</p>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="general">General</h3>
<ul>
<li>
<p><strong>Q G.1</strong>: Which lectures are required for working on project 2?<br>
<strong>A G.1</strong>: Lecture on RISCV-Intro, <code>lw</code>, <code>sw</code>, Decisions and Lecture RISC-V Decisions, Procedures </p>
</li>
<li>
<p><strong>Q G.2</strong>: Are there performance requirements?<br>
<strong>A G.2</strong>: While there are no specific requirements, your 
program must be reasonably efficient. Each test of the autograder gives a
 timeout much larger than what it takes for the staff solution to run so
 if your submission times out, your solutions is not efficient. Common 
causes is excessive calls to ecalls. Those should be used sparingly 
otherwise your program will become much less efficient.</p>
</li>
<li>
<p><strong>Q G.3</strong>: If I have a bug in <insert function="" here="">, will I lose credit for other functions which use this function?<br>
<strong>A G.3</strong>: No! We have designed the autograder to only test
 a specific function at a time. This means if you fail a test, it will 
not cause you to fail other tests. Note that if there are multiple tests
 testing the same function for different things, you will fail those 
tests.</insert></p>
</li>
<li>
<p><strong>Q G.4</strong>: Will calling convention be emphasised heavily? (If I don't following calling convention will it affect my overall grade?)<br>
<strong>Q A.4</strong>: Calling convention is incredibly important to 
not just this project but assembly itself. By not following calling 
convention, you open yourself up to a variety of bugs and 
vulnerabilities. Do not neglect it and do not rely on the Venus <code>-cc</code>
 checker to ensure calling convention correctness. It is highly 
recommended you complete Lab04 prior to this project to ensure a sound 
understanding of calling convention.</p>
</li>
</ul>
<h3 id="unit-testing-framework">Unit Testing Framework</h3>
<ul>
<li>
<p><strong>Q U.1</strong>: Why am I not able to <code>git add</code> the generated tests in <code>unittests/assembly</code>?<br>
<strong>A U.1</strong>: We added a .gitignore file in unittests, because committing generated files
is generally considered bad practise.</p>
</li>
<li>
<p><strong>Q U.2</strong>: Why do I get an <code>unrecognized arguments -k [...]</code> error when trying to run the unittests?<br>
<strong>A U.2</strong>: The <code>-k</code> flag was only added in Python 3.7.
The project spec was updated with commands that should work on older Python versions as well.</p>
</li>
<li>
<p><strong>Q U.3</strong>: How can we check the return code?<br>
<strong>A U.3</strong>: You can change the optional <code>code</code> argument to the <code>execute</code> method of the <code>AssemblyTest</code> class.
By default the expected <code>code</code> is <code>0</code>, to check a different exit code follow the usage <code>t.execute(code=???)</code>.</p>
</li>
<li>
<p><strong>Q U.4</strong>: Can we import non-standard libraries like numpy?<br>
<strong>A U.4</strong>: The autograder will only have access to the Python standard library and an <code>import numpy</code> will make it fail.
You can always play around with numpy by making a new unittest file.
However, these additional tests will not be considered by the autograder.</p>
</li>
<li>
<p><strong>Q U.5</strong>: What exactly do you measure for coverage?<br>
<strong>A U.5</strong>: We measure the number of times an instruction in your implementation (e.g. in <code>abs.s</code>) was executed
across all your tests. So a single test alone does not need to cover all instructions in your code.
In order to get points for coverage you need to have tests that - together - execute every single instruction
in your implementation at least once. Simply, cover all branches and different flows of execution through your program. </p>
</li>
<li>
<p><strong>Q U.6</strong>: How can I see the instructions that I am not covering?<br>
<strong>A U.6</strong>: In the call to <code>print_coverage</code>, that will be executed after all your tests are run, change <code>verbose</code> to <code>True</code>.
This will print out the coverage for every single instruction in your implementation.</p>
</li>
<li>
<p><strong>Q U.7</strong>: Why am I getting an <code>argument of type 'WindowsPath' is not iterable</code> error on Windows?<br>
<strong>A U.7</strong>: On Windows you need Python 3.8 (the latest stable release) to run the unit tests.
Alternatively you can use WSL which should work with older Python 3 versions.</p>
</li>
<li>
<p><strong>Q U.8</strong>: Can we change the arguments to some of the tests?<br>
<strong>A U.8</strong>: Feel free to change the code we provide.
The only thing that needs to stay the same are the names of the TestCase classes.
The autograder has these hard coded when measuring your coverage.</p>
</li>
<li>
<p><strong>Q U.9</strong>: Why am I getting a <code>ImportError: Failed to import test module: TestAbs</code> error?<br>
<strong>A U.9</strong>: You need to run the unit tests from the <code>unittests</code> directory! </p>
</li>
</ul>
<h3 id="part-a">Part A</h3>
<h4 id="abs">Abs</h4>
<ul>
<li>
<p><strong>Q A.1</strong>: How thoroughly should we test the <code>abs</code> function?<br>
<strong>A A.1</strong>: The <code>abs</code> function is just an introductory example.
If you did everything we showed you in the intro video, you should be good to go!</p>
</li>
<li>
<p><strong>Q A.2</strong>: Are we graded on <code>abs</code>?<br>
<strong>A A.2</strong>: The autograder checks to make sure that you successfully made the changes that we show you in the video.
Nothing beyond that.</p>
</li>
</ul>
<h4 id="relu-and-argmax">ReLU and ArgMax</h4>
<ul>
<li>
<p><strong>Q X.1</strong>: How do I exit (or terminate) the program with an error code?<br>
<strong>A X.1</strong>: Have a look at the <code>exit2</code> function that we provide in <code>utils.s</code></p>
</li>
<li>
<p><strong>Q X.2</strong>: Should we copy over functions from <code>utils.s</code> to our own code?<br>
<strong>A X.2</strong>: Please <strong>never</strong> copy a function out of utils.s!
When you write a unit test, <code>utils.s</code> will automatically be imported.
When debugging in venus, make sure that you run your unit test (found in <code>unittests/assembly</code>)
instead of trying to run the <code>relu.s</code> file directly, e.g., <code>vdb  unittests/assembly/TestRelu_test_simple.s</code>.
We show you how to do this in the introductory video.</p>
</li>
<li>
<p><strong>Q X.3</strong>: Why do I get a <code>could not find label exit2</code> or <code>label exit2 used but not defined</code> error?<br>
<strong>A X.3</strong>: You should never run your <code>relu.s</code> file in venus.
Instead run a unit test, e.g., <code>vdb  unittests/assembly/TestRelu_test_simple.s</code></p>
</li>
<li>
<p><strong>Q X.4</strong>: What do you mean by a 1-D vector?<br>
<strong>A X.4</strong>: The relu function will treat the matrix as a contiguous vector,
e.g. a <code>3x2</code> matrix would be treated as a vector of size <code>6</code>.</p>
</li>
<li>
<p><strong>Q X.5</strong>: Do we always need to fill in an epilogue and a prologue?<br>
<strong>A X.5</strong>: You always need to obey by the calling convention!
Sometimes no additional code is required for that and the epilogue or the prologue may be left empty in that case.</p>
</li>
</ul>
<h4 id="dot-product">Dot Product</h4>
<ul>
<li>
<p><strong>Q D.1</strong>: How can I verify that the vector length argument actually matches the size of the memory allocated for the vector?
<em>OR</em> How can I verify that enough memory was allocated for the vector?<br>
<strong>A D.1</strong>: Like in C, there is no way for the function to verify that the vector length argument
actually matches the size of memory allocated for the vector.</p>
</li>
<li>
<p><strong>Q D.2</strong>: Are we allowed to add extra labels?<br>
<strong>A D.2</strong>: Yes, just do not make them global (<code>.globl</code>).</p>
</li>
<li>
<p><strong>Q D.3</strong>: Can we assume that the autograder might change registers to test calling convention like lab04's autograder did?<br>
<strong>A D.3</strong>: The autograder might change some registers when you call a function (but only the ones it is allowed to overwrite).
Make sure to follow the calling conventions, also when calling your own functions (like <code>dot</code> from <code>matmul</code>)!</p>
</li>
</ul>
<h4 id="matmul">Matmul</h4>
<ul>
<li>
<p><strong>Q M.1</strong>: Can we assume that the memory region pointed to by <code>a6</code> has enough space to store the result?<br>
<strong>A M.2</strong>: The region of memory that <code>a6</code> is pointing to has enough space to fit all values of the result <code>d</code>.
The matmul function itself does <strong>not</strong> have to call <code>malloc</code> to allocate space for the result.</p>
</li>
<li>
<p><strong>Q M.3</strong>: Can we assume that the dimensions that are provided in the argument match the number of elements in the array?
If we cannot, how can we check the length of the array?<br>
<strong>A M.3</strong>: Like in C, there is no way for the function to verify that the matrix size argument actually
matches the size of memory allocated for the matrix.</p>
</li>
<li>
<p><strong>Q M.4</strong>: Is <code>matmul</code> only supposed to work on matrices that are square?<br>
<strong>A M.4</strong>: Matrices don't need to be square. Checking that the dimensions of m0 and m1 match is one of the three
error checks you need to perform (see the description in <code>matmul.s</code> for a list of all the checks you need to perform).</p>
</li>
<li>
<p><strong>Q M.5</strong>: Can we assume that <code>d</code> is initialized to anything in particular?<br>
<strong>A M.5</strong>: No. Assume that enough memory for <code>d</code> is allocated, but the values are uninitialized.</p>
</li>
<li>
<p><strong>Q M.6</strong>: Is it ok to check for invalid arguments before the Prologue?<br>
<strong>A M.6</strong>: Yes. Just make sure that you do not violate the calling conventions.</p>
</li>
<li>
<p><strong>Q M.7</strong>: Is it ok to save the value of a <code>t</code> register to the stack and restore it after calling a function?<br>
<strong>A M.7</strong>: Yes. All the calling convention says is that <code>t</code> registers could contain arbitrary values after you
call a function. Just make sure to properly decrement/increment the stack pointer.</p>
</li>
<li>
<p><strong>Q M.8</strong>: What does it mean for the dimensions of <code>m0</code> and <code>m1</code> to “make sense”?<br>
<strong>A M.8</strong>: The number of rows and columns should be greater or equal to 1.</p>
</li>
</ul>
<h3 id="part-b">Part B</h3>
<h4 id="read-matrix">Read Matrix</h4>
<ul>
<li>
<p><strong>Q R.1</strong>: How can we tell if <code>malloc</code> failed?<br>
<strong>A R.1</strong>: The returned address will be <code>0</code>.</p>
</li>
<li>
<p><strong>Q R.2</strong>: How can we tell if <code>fopen</code> failed?<br>
<strong>A R.2</strong>: Please read the section on <code>fopen</code> in the <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj2/#file-operations">project spec</a>.</p>
</li>
<li>
<p><strong>Q R.3</strong>: When are we supposed to exit with code <code>1</code>?<br>
<strong>A R.3</strong>: Please <strong>never</strong> exit with code <code>1</code>.
This semester, all error codes are various numbers between 32 and 67 (in decimal).</p>
</li>
<li>
<p><strong>Q R.4</strong>: Some of my <code>.data</code> is not aligned to a multiple of four. Why?<br>
<strong>A R.4</strong>: The venus linker does not align any of the static data sections. Thus a <code>.word</code> could start at any address.</p>
</li>
<li>
<p><strong>Q R.5</strong>: What error code should we use if the matrix is empty?<br>
<strong>A R.5</strong>: Since we do not specify an error code for this, you can assume that all matrices
that are read in will have dimensions that make sense.</p>
</li>
<li>
<p><strong>Q R.6</strong>: How can we test that the output array of <code>read_matrix</code> is correct?<br>
<strong>A R.6</strong>: Checkout the <code>check_array_pointer</code> method of the <code>AssemblyTest</code> class.</p>
</li>
</ul>
<h4 id="write-matrix">Write Matrix</h4>
<ul>
<li>
<p><strong>Q W.1</strong>: Are we supposed to call <code>fflush</code>?<br>
<strong>A W.1</strong>: There should be no need to call <code>fflush</code>
 in your final code, but you may find it useful when debugging. Most 
systems take a long time to write to memory/stdout, so they use a buffer
 to store multiple writes, and write data all at once. If your code 
crashes before that data gets written, the previous writes get lost, and
 this can make things hard to debug. fflush forces the system to clear 
the buffer, so that any previous writes get outputted for certain.</p>
</li>
<li>
<p><strong>Q W.2</strong>: What exit code should I return if <code>malloc</code> fails?<br>
<strong>A W.2</strong>: While using <code>malloc</code> is not required to implement this function,
you should always return the exit code <code>48</code> in case malloc fails.</p>
</li>
<li>
<p><strong>Q W.3</strong>: <code>do_write_matrix</code> always checks the output file, but when I am testing an error case,
there will be no file produced. How can I deal with this?<br>
<strong>A W.3</strong>: You are free to add your own code to <code>do_write_matrix</code>, e.g., in order to skip the file check when it is unnecessary</p>
</li>
</ul>
<h4 id="classify">Classify</h4>
<ul>
<li>
<p><strong>Q C.1</strong>: Can we assume that the input matrix is flattened?<br>
<strong>A C.1</strong>: The inputs to the MNIST and the <code>simple0</code> networks will be matrices with N rows and a single column.
You can look at example inputs like this: <code>cat inputs/simple0/txt/inputs/input0.txt</code>.
However, the simple2 network actually expects inputs with more than one column.
Please consult the <a href="https://inst.eecs.berkeley.edu/%7Ecs61c/su21/projects/proj2/#simple">project spec</a> to try and understand how to handle that case.</p>
</li>
<li>
<p><strong>Q C.2</strong>: How long should it take to classify an MNIST input?<br>
<strong>A C.2</strong>: On a 5-year old laptop with OpenJDK 1.8, the staff solution takes ~33s or ~1.2 million instructions
to classify <code>mnist_input0.bin</code>.</p>
</li>
<li>
<p><strong>Q C.3</strong>: Do we have to free previously allocated memory if a call to <code>malloc</code> fails?<br>
<strong>A C.3</strong>: No. You do not need to free before exiting.</p>
</li>
<li>
<p><strong>Q C.4</strong>: What is the difference between <code>TestClassify</code> and <code>TestMain</code>?<br>
<strong>A C.4</strong>: <code>TestMain</code> is very similar to the sanity checks that the autograder runs.
<code>TestClassify</code> was meant for you to extend in order to test corner cases.
For example <code>TestMain</code> always sets <code>a0</code> to <code>0</code>, TestClassify should test the other value for <code>a2</code>.</p>
</li>
<li>
<p><strong>Q C.5</strong>: How long does the autograder take? 
<strong>A C.5</strong>: On average it can take 2-5min to run.</p>
</li>
<li>
<p><strong>Q C.6</strong>: Should our code be able to create a folder if a directory in the output path does not exist?<br>
<strong>A C.6</strong>: No. You can assume that the output directory exists. Only the file needs to be created by <code>fopen</code>.</p>
</li>
<li>
<p><strong>Q C.7</strong>: Are the tests and matrices given in the starter code sufficient for testing?
<strong>A C.7</strong>: No; the provided files cover a variety of 
dimensions. For example the simple2 inputs have more than one column in 
them, meaning that your "scores" matrix will also have more than one 
column. Your code should still work as expected in this case, writing 
the matrix of "scores" to a file, and printing a single integer that is 
the row-major index of the largest element of that matrix. <strong>However</strong>,
 this does not mean that it's comprehensive; the files and tests are 
there to merely give you a starting point; making any assumptions about 
dimensionality could cause &lt; 100% coverage.</p>
</li>
</ul>

  </div>
</div>

      </div>
    </section>
  </main>

  
<script>
  

  
    document.addEventListener("DOMContentLoaded", function() {
      initToC();
    });
  
</script>




</body></html>